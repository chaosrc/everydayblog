---
title: 使用存储过程（一）
date: 2019-09-26
---


##  使用存储过程（一）



#### 什么是存储过程

前面我们使用的 SQL 语句大多数是针对一个或多个表的单条语句，但是在现实中经常会遇到一些复杂的操作，需要对多个表执行多条 SQL 语句，可能 SQL 语句执行的顺序也不一样。可以通过单独编写每一条 SQL 语句，并根据结果有条件的执行语句来实现，这时就可以使用存储过程。

存储过程，简单来说就是为了以后使用而保持的一条或多条 SQL 语句




#### 为什么要使用存储过程

存储过程的优势：
- 通过把处理封装在一个易用单元中，可以简化复杂操作
- 由于不需要反复建立一系列处理步骤，因此保证了数据的-一致性，如果所有开发人员使用同一存储过程，那么所使用的代码也都是相同的，减少出错的可能性，特别是对于复杂的查询
- 简化对变动的管理，如果对表名、列名等有修改，那么只需要更改存储过程的代码
- 因为存储过程通常以编译的形式存储，所以数据库处理命令所需的工作量更少，提高了性能

存储过程的缺陷：
- 不同的数据库存储过程的语法有所不同，编写真正的可移植存储过程几乎是不可能的
- 存储过程比编写 SQL 语句复杂，需要更高的技能和经验，因此许多数据库管理员限制将存储过程的创建做为安全措施

虽然有这些缺陷，但是存储过程还是非常有用



#### 执行存储过程

执行存储过程的 SQL 使用 EXECUTE ，EXECUTE 接受存储过程名和需要传递的参数

```sql
EXECUTE AddNewProduct('JTS01',
                       'Stuffed Eiffel Tower',
                       6.49,
                       'Plush stuff toy');
```
上面的语句中执行了一个名为 AddNewProduct 的存储过程，将新的产品添加到 Products 表中，其中的 4 个参数分别为供应商ID（vend_id）、品名称、价格、描述



#### 创建存储过程

下面创建一个简单的存储过程，对邮件发送清单中有邮件地址的顾客进行计数

Oracle 版本

输入
```sql
CREATE PROCEDURE MailingListCount( ListCount OUT INTEGER ) 
IS
v_rows INTEGER;
BEGIN
    SELECT COUNT(*)  INTO v_rows
    FROM Customers
    WHERE NOT cust_email IS NULL;
    ListCount := v_rows;
END
```
这个存储过程有一个名为 ListCount 的参数，并使用 OUT 关键词，表示参数从存储过程返回一个值而不是传递一个值给存储过程






