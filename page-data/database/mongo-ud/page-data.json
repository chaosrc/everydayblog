{"componentChunkName":"component---src-templates-blog-post-js","path":"/database/mongo-ud/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"deaf6b42-16ca-5930-904c-c2577ac8ad0e","excerpt":"MongoDB 数据库更新和删除操作更新文档MongoDB 中提供了三个方法更新文档Collection.updateOneCollection.updateManyCollection.replaceOne以及更新文档的操作符, 操作符的使用形式如下：常用的操作符操作符描述$set更新文档中对应字段的值$min…","html":"<h2>MongoDB 数据库更新和删除操作</h2>\n<h4>更新文档</h4>\n<p>MongoDB 中提供了三个方法更新文档</p>\n<ul>\n<li>Collection.updateOne</li>\n<li>Collection.updateMany</li>\n<li>Collection.replaceOne</li>\n</ul>\n<p>以及更新文档的操作符, 操作符的使用形式如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">&lt;</span>update operator<span class=\"token operator\">></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">&lt;</span>field1<span class=\"token operator\">></span><span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>value1<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">&lt;</span>update operator<span class=\"token operator\">></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">&lt;</span>field2<span class=\"token operator\">></span><span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>value2<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>常用的操作符</p>\n<table>\n<thead>\n<tr>\n<th>操作符</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>$set</td>\n<td>更新文档中对应字段的值</td>\n</tr>\n<tr>\n<td>$min</td>\n<td>只更新文档中小于当前值的字段</td>\n</tr>\n<tr>\n<td>$max</td>\n<td>只更新文档中大于当前值的字段</td>\n</tr>\n<tr>\n<td>$currentDate</td>\n<td>设置字段的值为当前时间</td>\n</tr>\n<tr>\n<td>$rename</td>\n<td>重命名字段</td>\n</tr>\n</tbody>\n</table>\n<p>使用 updateOne 更新文档</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'article'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span>\n        item<span class=\"token punctuation\">:</span> <span class=\"token string\">'paper'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        $<span class=\"token keyword\">set</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> qty<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">:</span> <span class=\"token string\">'C'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        $currentDate<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> modifiedDate<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>选择了集合 article 中 item 字段为 ‘paper’ 值的文档，更新其 qty 和 status 字段，并且将 modifiedDate 设置为当前时间，如果 modifiedDate 字段不存在则会自动创建</p>\n<p>更新前</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"5d372d0b61329f241be05720\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"item\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"paper\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"qty\"</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"h\"</span><span class=\"token operator\">:</span> <span class=\"token number\">8.5</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"w\"</span><span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"uom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"in\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"D\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>更新后</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>  \n    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"5d372d0b61329f241be05720\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"item\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"paper\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"qty\"</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"h\"</span><span class=\"token operator\">:</span> <span class=\"token number\">8.5</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"w\"</span><span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"uom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"in\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"C\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"modifiedDate\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2019-07-24T16:14:30.906Z\"</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h4>删除文档</h4>\n<p> MongoDB 中提供了两个方法删除文档</p>\n<ul>\n<li>Collection.deleteMany</li>\n<li>Collection.deleteOne</li>\n</ul>\n<p> 使用 deleteMany 方法传人<code class=\"language-text\">{}</code>空对象，删除集合中的所有文档，deleteMany 返回 reult，result.deletedCount 为删除的文档条数</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'article'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">deleteMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>在 deleteMany 中传人<strong>查询操作</strong>，将会删除所有匹配的文档</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'article'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">delectMant</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> qty<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $lt<span class=\"token punctuation\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>deleteOne 只删除所有匹配项中的第一个</p>","frontmatter":{"title":"MongoDB 数据库更新和删除操作","date":"July 24, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/database/mongo-ud/","previous":{"fields":{"slug":"/database/MongoDB-CRUD/"},"frontmatter":{"title":"MongoDB 数据库插入和查询操作"}},"next":{"fields":{"slug":"/database/redis/"},"frontmatter":{"title":"在 Node.js 中使用 Redis"}}}}}