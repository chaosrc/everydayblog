{"componentChunkName":"component---src-templates-blog-post-js","path":"/sql/sql-views-2/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"25b4633a-27f0-535b-9f6d-5fa9515afccc","excerpt":"使用视图（二）使用视图重新格式化检索出的数据重新格式化检索出的数据是视图最常见的用途之一。下面的 SQL 语句组合计算供应商的名称和位置：输入输出如果需要经常用得上面这个格式的结果，可以创建一个视图来使用，而不必每次执行时进行拼接输入再使用视图进行数据检索输入输出使用视图过滤不需要的数据视图对于应用普通的 WHERE…","html":"<h2>使用视图（二）</h2>\n<h4>使用视图重新格式化检索出的数据</h4>\n<p>重新格式化检索出的数据是视图最常见的用途之一。下面的 SQL 语句组合计算供应商的名称和位置：</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> RTRIM<span class=\"token punctuation\">(</span>vend_name<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'('</span> <span class=\"token operator\">+</span> RTRIM<span class=\"token punctuation\">(</span>vend_country<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">')'</span> <span class=\"token keyword\">AS</span> vend_title\n<span class=\"token keyword\">FROM</span> Vendors\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> vend_name<span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">vend_title        \n<span class=\"token comment\">------------------</span>\nBears R Us<span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nBear Emporium<span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nDoll House Inc<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nFurball Inc<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nFun <span class=\"token operator\">and</span> Games<span class=\"token punctuation\">(</span>England<span class=\"token punctuation\">)</span>\nJouets et ours<span class=\"token punctuation\">(</span>France<span class=\"token punctuation\">)</span></code></pre></div>\n<p>如果需要经常用得上面这个格式的结果，可以创建一个视图来使用，而不必每次执行时进行拼接</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">VIEW</span> VendorLocation <span class=\"token keyword\">AS</span>\n<span class=\"token keyword\">SELECT</span> RTRIM<span class=\"token punctuation\">(</span>vend_name<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'('</span> <span class=\"token operator\">+</span> RTRIM<span class=\"token punctuation\">(</span>vend_country<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">')'</span> <span class=\"token keyword\">AS</span> vend_title\n<span class=\"token keyword\">FROM</span> Vendors<span class=\"token punctuation\">;</span></code></pre></div>\n<p>再使用视图进行数据检索</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> VendorLocation<span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">vend_title     \n<span class=\"token comment\">---------------</span>\nBears R Us<span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nBear Emporium<span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nDoll House Inc<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nFurball Inc<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nFun <span class=\"token operator\">and</span> Games<span class=\"token punctuation\">(</span>England<span class=\"token punctuation\">)</span>\nJouets et ours<span class=\"token punctuation\">(</span>France<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>使用视图过滤不需要的数据</h4>\n<p>视图对于应用普通的 WHERE 子句也很有用。比如要过滤没有电子邮箱的顾客</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">VIEW</span> CustomerEmailList <span class=\"token keyword\">AS</span>\n<span class=\"token keyword\">SELECT</span> cust_id<span class=\"token punctuation\">,</span> cust_name<span class=\"token punctuation\">,</span> cust_email\n<span class=\"token keyword\">FROM</span> Customers\n<span class=\"token keyword\">WHERE</span> cust_email <span class=\"token operator\">IS</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上面的语句创建了视图 CustomerEmailList，并使用 WHERE 子句过滤掉了 cust_email 为 NULL 的值</p>\n<p>检索 CustomerEmailList</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> CustomerEmailList<span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">1000000001</span><span class=\"token operator\">|</span>Village Toys<span class=\"token operator\">|</span>sales<span class=\"token variable\">@villagetoys.com</span>\n<span class=\"token number\">1000000003</span><span class=\"token operator\">|</span>Fun4All<span class=\"token operator\">|</span>jjones<span class=\"token variable\">@fun4all.com</span>\n<span class=\"token number\">1000000004</span><span class=\"token operator\">|</span>Fun4All<span class=\"token operator\">|</span>dstephens<span class=\"token variable\">@fun4all.com</span>\n<span class=\"token number\">1000000005</span><span class=\"token operator\">|</span>The Toy Store<span class=\"token operator\">|</span>abc<span class=\"token variable\">@qq.com</span></code></pre></div>\n<h4>视图与计算字段</h4>\n<p>下面是检索订单物品，并计算每种物品的总价格</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> prod_id<span class=\"token punctuation\">,</span> \n       quantity<span class=\"token punctuation\">,</span>\n       item_price<span class=\"token punctuation\">,</span>\n       quantity <span class=\"token operator\">*</span> item_price <span class=\"token keyword\">AS</span> total_price\n<span class=\"token keyword\">FROM</span> OrderItems\n<span class=\"token keyword\">WHERE</span> order_num <span class=\"token operator\">=</span> <span class=\"token number\">20008</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">RGAN01<span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">4.99</span><span class=\"token operator\">|</span><span class=\"token number\">24.95</span>\nBR03<span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">11.99</span><span class=\"token operator\">|</span><span class=\"token number\">59.95</span>\nBNBG01<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span>\nBNBG02<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span>\nBNBG03<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span></code></pre></div>\n<p>创建视图</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">VIEW</span> OrderItemPrice <span class=\"token keyword\">AS</span>\n<span class=\"token keyword\">SELECT</span> prod_id<span class=\"token punctuation\">,</span>\n       quantity<span class=\"token punctuation\">,</span>\n       item_price<span class=\"token punctuation\">,</span>\n       order_num<span class=\"token punctuation\">,</span>\n       quantity <span class=\"token operator\">*</span> item_price <span class=\"token keyword\">AS</span> total_price\n<span class=\"token keyword\">FROM</span> OrderItems<span class=\"token punctuation\">;</span></code></pre></div>\n<p>在视图上检索订单内容</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> OrderItemPrice\n<span class=\"token keyword\">WHERE</span> order_num <span class=\"token operator\">=</span> <span class=\"token string\">'20008'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">RGAN01<span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">4.99</span><span class=\"token operator\">|</span><span class=\"token number\">20008</span><span class=\"token operator\">|</span><span class=\"token number\">24.95</span>\nBR03<span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">11.99</span><span class=\"token operator\">|</span><span class=\"token number\">20008</span><span class=\"token operator\">|</span><span class=\"token number\">59.95</span>\nBNBG01<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">20008</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span>\nBNBG02<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">20008</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span>\nBNBG03<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">20008</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span></code></pre></div>\n<p>可以看到视图非常容易创建，而且很好使用，正确使用可以极大的简化复杂数据的处理</p>","frontmatter":{"title":"使用视图（二）","date":"September 25, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/sql/sql-views-2/","previous":{"fields":{"slug":"/typescript/types-100/"},"frontmatter":{"title":"Typescript 及其基本类型"}},"next":{"fields":{"slug":"/sql/sql-procedure-1/"},"frontmatter":{"title":"使用存储过程（一）"}}}}}