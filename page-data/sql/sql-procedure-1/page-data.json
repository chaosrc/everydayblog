{"componentChunkName":"component---src-templates-blog-post-js","path":"/sql/sql-procedure-1/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"c7f2ea23-f3e2-58fa-a2bf-eddaa7510a85","excerpt":"使用存储过程（一）什么是存储过程前面我们使用的 SQL 语句大多数是针对一个或多个表的单条语句，但是在现实中经常会遇到一些复杂的操作，需要对多个表执行多条 SQL 语句，可能 SQL 语句执行的顺序也不一样。可以通过单独编写每一条 SQL…","html":"<h2>使用存储过程（一）</h2>\n<h4>什么是存储过程</h4>\n<p>前面我们使用的 SQL 语句大多数是针对一个或多个表的单条语句，但是在现实中经常会遇到一些复杂的操作，需要对多个表执行多条 SQL 语句，可能 SQL 语句执行的顺序也不一样。可以通过单独编写每一条 SQL 语句，并根据结果有条件的执行语句来实现，这时就可以使用存储过程。</p>\n<p>存储过程，简单来说就是为了以后使用而保持的一条或多条 SQL 语句</p>\n<h4>为什么要使用存储过程</h4>\n<p>存储过程的优势：</p>\n<ul>\n<li>通过把处理封装在一个易用单元中，可以简化复杂操作</li>\n<li>由于不需要反复建立一系列处理步骤，因此保证了数据的-一致性，如果所有开发人员使用同一存储过程，那么所使用的代码也都是相同的，减少出错的可能性，特别是对于复杂的查询</li>\n<li>简化对变动的管理，如果对表名、列名等有修改，那么只需要更改存储过程的代码</li>\n<li>因为存储过程通常以编译的形式存储，所以数据库处理命令所需的工作量更少，提高了性能</li>\n</ul>\n<p>存储过程的缺陷：</p>\n<ul>\n<li>不同的数据库存储过程的语法有所不同，编写真正的可移植存储过程几乎是不可能的</li>\n<li>存储过程比编写 SQL 语句复杂，需要更高的技能和经验，因此许多数据库管理员限制将存储过程的创建做为安全措施</li>\n</ul>\n<p>虽然有这些缺陷，但是存储过程还是非常有用</p>\n<h4>执行存储过程</h4>\n<p>执行存储过程的 SQL 使用 EXECUTE ，EXECUTE 接受存储过程名和需要传递的参数</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXECUTE</span> AddNewProduct<span class=\"token punctuation\">(</span><span class=\"token string\">'JTS01'</span><span class=\"token punctuation\">,</span>\n                       <span class=\"token string\">'Stuffed Eiffel Tower'</span><span class=\"token punctuation\">,</span>\n                       <span class=\"token number\">6.49</span><span class=\"token punctuation\">,</span>\n                       <span class=\"token string\">'Plush stuff toy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上面的语句中执行了一个名为 AddNewProduct 的存储过程，将新的产品添加到 Products 表中，其中的 4 个参数分别为供应商ID（vend_id）、品名称、价格、描述</p>\n<h4>创建存储过程</h4>\n<p>下面创建一个简单的存储过程，对邮件发送清单中有邮件地址的顾客进行计数</p>\n<p>Oracle 版本</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">PROCEDURE</span> MailingListCount<span class=\"token punctuation\">(</span> ListCount <span class=\"token keyword\">OUT</span> <span class=\"token keyword\">INTEGER</span> <span class=\"token punctuation\">)</span> \n<span class=\"token operator\">IS</span>\nv_rows <span class=\"token keyword\">INTEGER</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">BEGIN</span>\n    <span class=\"token keyword\">SELECT</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>  <span class=\"token keyword\">INTO</span> v_rows\n    <span class=\"token keyword\">FROM</span> Customers\n    <span class=\"token keyword\">WHERE</span> <span class=\"token operator\">NOT</span> cust_email <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">;</span>\n    ListCount :<span class=\"token operator\">=</span> v_rows<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span></code></pre></div>\n<p>这个存储过程有一个名为 ListCount 的参数，并使用 OUT 关键词，表示参数从存储过程返回一个值而不是传递一个值给存储过程</p>","frontmatter":{"title":"使用存储过程（一）","date":"September 26, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/sql/sql-procedure-1/","previous":{"fields":{"slug":"/sql/sql-views-2/"},"frontmatter":{"title":"使用视图（二）"}},"next":{"fields":{"slug":"/sql/sql-commit/"},"frontmatter":{"title":"管理事务处理"}}}}}