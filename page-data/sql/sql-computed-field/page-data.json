{"componentChunkName":"component---src-templates-blog-post-js","path":"/sql/sql-computed-field/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"d55f9108-befb-5847-b8fd-3974b79b47f9","excerpt":"创建计算字段一般储存在表中数据可能不是应用程序所需要的格式，我们需要对数据库中检索的字段进行转换、计算或者格式化后再返回给应用程序，这时就可以使用计算字段拼接字段可以通过拼接字段来使用计算字段。我们现在有一个 Vendors…","html":"<h2>创建计算字段</h2>\n<p>一般储存在表中数据可能不是应用程序所需要的格式，我们需要对数据库中检索的字段进行转换、计算或者格式化后再返回给应用程序，这时就可以使用计算字段</p>\n<h4>拼接字段</h4>\n<p>可以通过拼接字段来使用计算字段。我们现在有一个 Vendors 表，里面包含供应商名和地址信息列，如果要生成一个报表，报表中需要展示名称和供应商，并且供应商使用括号扩起来，而数据库中并没有名称和供应商组合的字段以及括号，这时可以使用拼接字段进行组合</p>\n<p>在不同的数据库中拼接字段的方式不一样，多数数据库可以使用加号（+）或者两个竖杠（||）表示，在 MySQL 和 MariaDB 中，必须使用特殊的函数</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> vend_name <span class=\"token operator\">||</span> <span class=\"token string\">' ('</span> <span class=\"token operator\">||</span>  vend_country <span class=\"token operator\">||</span> <span class=\"token string\">')'</span>\n<span class=\"token keyword\">FROM</span> Vendors\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> vend_name<span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">Bear Emporium <span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nBears R Us <span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nDoll House Inc<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nFun <span class=\"token operator\">and</span> Games <span class=\"token punctuation\">(</span>England<span class=\"token punctuation\">)</span>\nFurball Inc<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nJouets et ours <span class=\"token punctuation\">(</span>France<span class=\"token punctuation\">)</span></code></pre></div>\n<p>上面的 SELECT 语句拼接了以下语句：</p>\n<ul>\n<li>vend_name 列中的名字</li>\n<li>左括号字符</li>\n<li>vend_country 列中的国家</li>\n<li>右括号字符</li>\n</ul>\n<h4>使用别名</h4>\n<p>上面的 SQL 语句拼接了名称和地址，但是这个新计算的列没有名字，在应用程序中无法引用。为了解决这个问题，SQL 中支持别名，别名可以做为一个字段或值的替换名。使用 AS 关键词来声明别名</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> vend_name <span class=\"token operator\">||</span> <span class=\"token string\">' ('</span> <span class=\"token operator\">||</span> vend_country <span class=\"token operator\">||</span> <span class=\"token string\">')'</span>\n<span class=\"token keyword\">AS</span> vend_title\n<span class=\"token keyword\">FROM</span> Vendors\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> vend_title <span class=\"token keyword\">DESC</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">Jouets et ours <span class=\"token punctuation\">(</span>France<span class=\"token punctuation\">)</span>\nFurball Inc<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nFun <span class=\"token operator\">and</span> Games <span class=\"token punctuation\">(</span>England<span class=\"token punctuation\">)</span>\nDoll House Inc<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nBears R Us <span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span>\nBear Emporium <span class=\"token punctuation\">(</span>USA<span class=\"token punctuation\">)</span></code></pre></div>\n<p>上面的 SQL 语句对计算字段添加了别名 vend<em>title，使用 DESC 对 vend</em>title 进行降序排序，此时的 vend_title 在应用程序中也可以使用，就像一个实际的列一样</p>\n<h4>执行算数计算</h4>\n<p>计算字段另一个常用的地方是对检索的数据就像算数计算，比如   OrderItems 表中包含每个订单中各项物品的价格和数量，可以通过算数计算来计算出各个物品的总价格</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> prod_id<span class=\"token punctuation\">,</span> quantity<span class=\"token punctuation\">,</span> item_price<span class=\"token punctuation\">,</span> quantity <span class=\"token operator\">*</span> item_price <span class=\"token keyword\">AS</span> total_amount\n<span class=\"token keyword\">FROM</span> OrderItems\n<span class=\"token keyword\">WHERE</span> order_num <span class=\"token operator\">=</span> <span class=\"token number\">20008</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">RGAN01<span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">4.99</span><span class=\"token operator\">|</span><span class=\"token number\">24.95</span>\nBR03<span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">11.99</span><span class=\"token operator\">|</span><span class=\"token number\">59.95</span>\nBNBG01<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span>\nBNBG02<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span>\nBNBG03<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3.49</span><span class=\"token operator\">|</span><span class=\"token number\">34.9</span></code></pre></div>\n<p>上面的 SQL 语句中 total<em>amount 字段为计算字段，其值为 quantity * item</em>price，在应用程序中可以像其他实际字段一样使用</p>","frontmatter":{"title":"创建计算字段","date":"September 05, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/sql/sql-computed-field/","previous":{"fields":{"slug":"/sql/sql-select-like-2/"},"frontmatter":{"title":"用通配符进行过滤（二）"}},"next":{"fields":{"slug":"/sql/sql-function/"},"frontmatter":{"title":"使用函数处理数据"}}}}}