{"componentChunkName":"component---src-templates-blog-post-js","path":"/sql/sql-cursor/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"6be195dc-abde-5d67-aa48-5192dcdf4883","excerpt":"使用游标游标SQL 检索操作返回一组被称为结果集的行，这些行都是与 SQL 语句相匹配的行。简单地使用 SELECT 语句，无法得到第一行、下一行或前十行使用游标可以在检索出来的行中前进后退一行或多行。游标是一个存储在数据库服务器上的数据库查询，是 SELECT…","html":"<h2>使用游标</h2>\n<h4>游标</h4>\n<p>SQL 检索操作返回一组被称为结果集的行，这些行都是与 SQL 语句相匹配的行。简单地使用 SELECT 语句，无法得到第一行、下一行或前十行</p>\n<p>使用游标可以在检索出来的行中前进后退一行或多行。游标是一个存储在数据库服务器上的数据库查询，是 SELECT 语句检索的结果集，存储了游标后，可以根据需要滚动或浏览其中的数据</p>\n<p>游标的一些特性</p>\n<ul>\n<li>能够标记为只读，使数据能读取但不能更新和删除</li>\n<li>能控制可以执行的定向操作（向前、向后、绝对位置、相对位置等）</li>\n<li>能够标记某些列为可编辑，某些为不可编辑</li>\n<li>规定范围，控制特定的请求或所有请求可以访问</li>\n<li>指示数据库对检索的数据进行复制，使游标在打开和访问期间数据不会变化</li>\n</ul>\n<h4>使用游标</h4>\n<p>使用游标的步骤</p>\n<ul>\n<li>\n<p>在使用游标前，必须声明它，这时还没有检索数据，只是定义要使用的 SELECT 语句和游标选项</p>\n</li>\n<li>\n<p>一旦声明就必要打开游标以供使用，这个过程使用前面定义的 SELECT 语句将数据检索出来</p>\n</li>\n<li>\n<p>对于填有数据的游标，根据需要取出各行</p>\n</li>\n<li>\n<p>在结束游标使用时，必须关闭游标</p>\n</li>\n</ul>\n<p>游标声明后可以根据需要频繁地打开和关闭游标</p>\n<h4>创建游标</h4>\n<p>使用 DECLARE 语句创建游标，这条语句在不同的数据库中有所不同。DECLARE 命名游标，并定义相应的 SELECT 语句，根据需要带WHERE 子句或其他子句</p>\n<p>下面创建一个游标来检索没有电子邮件地址的所有顾客</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DECLARE</span> CustCursor <span class=\"token keyword\">CURSOR</span>\n<span class=\"token keyword\">FOR</span> \n<span class=\"token keyword\">SELECT</span> cust_name <span class=\"token keyword\">FROM</span> Customers\n<span class=\"token keyword\">WHERE</span> cust_email <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>使用 DECLARE 定义了一个游标 CustCursor。接下来就可以使用它了</p>\n<h4>使用游标</h4>\n<p>使用 OPEN CURSOR 语句打开游标</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">OPEN</span> CustCursor<span class=\"token punctuation\">;</span></code></pre></div>\n<p>使用 FETCH 语句访问数据，FETCH 指出要检索哪些行，从何处检索以及存放在何处</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">FETCH</span> cust_name <span class=\"token keyword\">INTO</span> custName<span class=\"token punctuation\">;</span></code></pre></div>\n<p>FETCH 语句检索一行数据并保持在 变量 custName 中</p>\n<h4>关闭游标</h4>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CLOSE</span> CustCursor<span class=\"token punctuation\">;</span></code></pre></div>\n<h4>完整的示例</h4>\n<p>创建存储过程</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DELIMITER</span> $$\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">PROCEDURE</span> execCursor<span class=\"token punctuation\">(</span> <span class=\"token keyword\">INOUT</span> name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">BEGIN</span>\n<span class=\"token comment\">-- 定义游标</span>\n<span class=\"token keyword\">DECLARE</span> custName <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">DECLARE</span> CustCursor <span class=\"token keyword\">CURSOR</span>\n<span class=\"token keyword\">FOR</span> \n<span class=\"token keyword\">SELECT</span> cust_name <span class=\"token keyword\">FROM</span> Customers\n<span class=\"token keyword\">WHERE</span> cust_email <span class=\"token operator\">IS</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">-- 打开游标</span>\n<span class=\"token keyword\">OPEN</span> CustCursor<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">-- 使用游标</span>\n<span class=\"token keyword\">FETCH</span> CustCursor <span class=\"token keyword\">INTO</span> custName<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> name <span class=\"token operator\">=</span> custName<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">-- 关闭游标</span>\n<span class=\"token keyword\">CLOSE</span> CustCursor<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">END</span>$$</code></pre></div>\n<p>使用游标</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SET</span> <span class=\"token variable\">@name</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CALL</span> execCursor<span class=\"token punctuation\">(</span><span class=\"token variable\">@name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token variable\">@name</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出结果</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">SET</span> <span class=\"token variable\">@name</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\nQuery OK<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token keyword\">rows</span> affected <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span>\n\nmysql<span class=\"token operator\">></span> <span class=\"token keyword\">CALL</span> execCursor<span class=\"token punctuation\">(</span><span class=\"token variable\">@name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nQuery OK<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token keyword\">rows</span> affected <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span>\n\nmysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> <span class=\"token variable\">@name</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">------------+</span>\n<span class=\"token operator\">|</span> <span class=\"token variable\">@name</span>      <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">------------+</span>\n<span class=\"token operator\">|</span> Kids Place <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">------------+</span>\n<span class=\"token number\">1</span> <span class=\"token keyword\">row</span> <span class=\"token operator\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span>\n\nmysql<span class=\"token operator\">></span> </code></pre></div>","frontmatter":{"title":"使用游标","date":"September 28, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/sql/sql-cursor/","previous":{"fields":{"slug":"/sql/sql-procedure-1/"},"frontmatter":{"title":"使用存储过程（一）"}},"next":{"fields":{"slug":"/sql/sql-commit/"},"frontmatter":{"title":"管理事务处理"}}}}}