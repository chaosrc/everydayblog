{"componentChunkName":"component---src-templates-blog-post-js","path":"/sql/sql-commit/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"de311e20-2901-58c2-8620-0a58ca565224","excerpt":"管理事务处理事务处理使用事务处理（tansaction processing），通过确保成批的 SQL 操作要么完全执行，要么完全不执行，来维护数据库的完整性。如果没有错误发生所有 SQL 操作将会提交到数据库表，如果发生错误，则进行回退，将数据库恢复到某个已知且安全的状态事务处理的术语事务（transaction…","html":"<h2>管理事务处理</h2>\n<h4>事务处理</h4>\n<p>使用事务处理（tansaction processing），通过确保成批的 SQL 操作要么完全执行，要么完全不执行，来维护数据库的完整性。如果没有错误发生所有 SQL 操作将会提交到数据库表，如果发生错误，则进行回退，将数据库恢复到某个已知且安全的状态</p>\n<p>事务处理的术语</p>\n<ul>\n<li>事务（transaction）指一组 SQL 语句</li>\n<li>回退（rollback）指撤销指定的 SQL 语句的过程</li>\n<li>提交（commit）指将未存储的 SQL 语句结果写入数据库表</li>\n<li>保留点（savepoint）指事务处理中设置的临时占位符，可以对它发布退回</li>\n</ul>\n<h4>控制事务处理</h4>\n<p>管理事务的关键在于将 SQL 语句组分解为逻辑块，并明确规定数据何时应该退回，何时不应该退回</p>\n<p>有些数据库要求明确标识事务处理的开始和结束</p>\n<p>在 SQL Server 中使用如下标识</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">BEGIN</span> <span class=\"token keyword\">TRANSACTION</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">COMMIT</span> <span class=\"token keyword\">TRANSACTION</span></code></pre></div>\n<p>上面的例子中，在 BEGIN TRANSACTION 和 COMMIT TRANSACTION 语句子句的 SQL 必须完全执行或完全不执行</p>\n<p>在 MySQL 中使用</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">START</span> <span class=\"token keyword\">TRANSACTION</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h4>使用 ROLLBACK</h4>\n<p>SQL 的 ROLLBACK 命令用来回退 SQL 语句</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">FROM</span> Orders<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">ROLLBACK</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上面的语句执行 DELETE 操作，然后用 ROLLBACK 语句撤销</p>\n<h4>使用 COMMIT</h4>\n<p>一般的 SQL 语句都是针对数据库表直接执行被编写的，这就是所谓的隐式提交，即提交操作是自动进行的</p>\n<p>在事务处理中，提交不会隐式进行。进行名叫的提交，使用 COMMIT 语句</p>\n<p>下面是 SQL Server 的例子</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">BEGIN</span> <span class=\"token keyword\">TRANSACTION</span> \n<span class=\"token keyword\">DELETE</span> OrderItems <span class=\"token keyword\">WHERE</span> order_num <span class=\"token operator\">=</span> <span class=\"token number\">1222</span>\n<span class=\"token keyword\">DELETE</span> Orders <span class=\"token keyword\">WHERE</span> order_num <span class=\"token operator\">=</span> <span class=\"token number\">1222</span>\n<span class=\"token keyword\">COMMIT</span> <span class=\"token keyword\">TRANSACTION</span></code></pre></div>\n<h4>使用保留点</h4>\n<p>使用简单的 ROLLBACK 和 COMMIT 语句，就可以写入或撤销整个事务，但是只有简单的任务才能这样做，复杂的事务可能需要部分提交或退回</p>\n<p>要支持回退部分数据，必须在事务处理中的合适位置放置占位符，这样如果需要回退，可以回到某个占位符，这些占位符称为保留点</p>\n<p>在 MySQL 和 Oracle 中占位符可以使用 SAVEPOINT</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ROLLBACK</span> <span class=\"token keyword\">to</span> <span class=\"token keyword\">delete</span></code></pre></div>\n<p>每个保留点都要能够标识它的唯一值。以便在回退时知道回退到何处</p>\n<p>在 MySQL 和 Oracle 使用 ROLLBACK</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ROLLBACK</span> <span class=\"token keyword\">TO</span> <span class=\"token keyword\">delete</span></code></pre></div>","frontmatter":{"title":"管理事务处理","date":"September 28, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/sql/sql-commit/","previous":{"fields":{"slug":"/sql/sql-procedure-1/"},"frontmatter":{"title":"使用存储过程（一）"}},"next":{"fields":{"slug":"/sql/sql-create-table-2/"},"frontmatter":{"title":"创建和操控表（二）"}}}}}