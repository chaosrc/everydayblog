{"componentChunkName":"component---src-templates-blog-post-js","path":"/sql/sql-child-query/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"8aa354ad-8171-52ce-a3f7-a11f979618a5","excerpt":"使用子查询在 SQL 语句中允许在查询语句中嵌套其他的查询语句，即子查询（subquery）利用子查询进行过滤现在存在三个表，Orders 表储存订单编号、客户 ID、订单日期，OrderItems 表储存订单物品的相关信息，Customer 表中储存客户信息。如果要列出订购物品 RGAN0…","html":"<h2>使用子查询</h2>\n<p>在 SQL 语句中允许在查询语句中嵌套其他的查询语句，即子查询（subquery）</p>\n<h4>利用子查询进行过滤</h4>\n<p>现在存在三个表，Orders 表储存订单编号、客户 ID、订单日期，OrderItems 表储存订单物品的相关信息，Customer 表中储存客户信息。如果要列出订购物品 RGAN01 的所有顾客，需要进行以下步骤：</p>\n<ul>\n<li>检索包含 RGAN01 的所有订单</li>\n<li>根据上一步订单编号检索所有的顾客 ID</li>\n<li>根据顾客 ID 检索所有顾客信息</li>\n</ul>\n<p>每一条都可以是一个 SQL 语句，将上一条的结果应用与下一条 SQL 语句</p>\n<p>第一步在 OrderItems 表中检索产品为 RGAN01 的订单</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> order_num\n<span class=\"token keyword\">FROM</span> OrderItems\n<span class=\"token keyword\">WHERE</span> prod_id <span class=\"token operator\">=</span> <span class=\"token string\">'RGAN01'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">20007</span>\n<span class=\"token number\">20008</span></code></pre></div>\n<p>第二步根据订单号在 Orders 表中检索检索顾客 ID</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> cust_id\n<span class=\"token keyword\">FROM</span> Orders\n<span class=\"token keyword\">WHERE</span> order_num <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token number\">20007</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20008</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">1000000004</span>\n<span class=\"token number\">1000000005</span></code></pre></div>\n<p>第三步根据顾客 ID 在 Customers 表中检索顾客信息</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> cust_name<span class=\"token punctuation\">,</span> cust_contact\n<span class=\"token keyword\">FROM</span> Customers\n<span class=\"token keyword\">WHERE</span> cust_id <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1000000004</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000000005</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">Fun4All<span class=\"token operator\">|</span>Denise L<span class=\"token punctuation\">.</span> Stephens\nThe Toy Store<span class=\"token operator\">|</span>Kim Howard</code></pre></div>\n<p>通过子查询将三个 SQL 语句合成一个</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> cust_name<span class=\"token punctuation\">,</span> cust_contact\n<span class=\"token keyword\">FROM</span> Customers\n<span class=\"token keyword\">WHERE</span> cust_id <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">SELECT</span> cust_id\n                   <span class=\"token keyword\">FROM</span> Orders\n                   <span class=\"token keyword\">WHERE</span> order_num <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">SELECT</span> order_num\n                                        <span class=\"token keyword\">FROM</span> OrderItems\n                                        <span class=\"token keyword\">WHERE</span> prod_id <span class=\"token operator\">=</span> <span class=\"token string\">'RGAN01'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">Fun4All<span class=\"token operator\">|</span>Denise L<span class=\"token punctuation\">.</span> Stephens\nThe Toy Store<span class=\"token operator\">|</span>Kim Howard</code></pre></div>\n<p>上面的 SQL 语句有两条子查询依次从内向外执行，效果等同于前面的三条 SQL 语句</p>\n<blockquote>\n<p>子查询只能查询单个列，检索多个列会报错</p>\n</blockquote>","frontmatter":{"title":"使用子查询","date":"September 13, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/sql/sql-child-query/","previous":{"fields":{"slug":"/sql/sql-group-2/"},"frontmatter":{"title":"分组数据（二）"}},"next":{"fields":{"slug":"/promise2/"},"frontmatter":{"title":""}}}}}