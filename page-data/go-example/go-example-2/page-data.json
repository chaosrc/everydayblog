{"componentChunkName":"component---src-templates-blog-post-js","path":"/go-example/go-example-2/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"7aff8efa-b720-57f5-9772-072321d96916","excerpt":"Golang 实战（二）用户注册创建用户模型模型与请求 body 绑定添加表单校验添加路由","html":"<h2>Golang 实战（二）</h2>\n<h4>用户注册</h4>\n<p>创建用户模型</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> users\n\n<span class=\"token keyword\">type</span> UserModel <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tID           <span class=\"token builtin\">uint</span>    <span class=\"token string\">`gorm:\"primary_key\"`</span>\n\tUsername     <span class=\"token builtin\">string</span>  <span class=\"token string\">`gorm:\"column:username\"`</span>\n\tEmail        <span class=\"token builtin\">string</span>  <span class=\"token string\">`gorm:\"column:email;unique_index\"`</span>\n\tBio          <span class=\"token builtin\">string</span>  <span class=\"token string\">`gorm:\"column:bio;size:1024\"`</span>\n\tImage        <span class=\"token operator\">*</span><span class=\"token builtin\">string</span> <span class=\"token string\">`gorm:\"column:image\"`</span>\n\tPasswordHash <span class=\"token builtin\">string</span>  <span class=\"token string\">`gorm:\"column:password;not null\"`</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>模型与请求 body 绑定</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> common\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"github.com/gin-gonic/gin\"</span>\n\t<span class=\"token string\">\"github.com/gin-gonic/gin/binding\"</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 使用 gin 模型绑定 https://github.com/gin-gonic/gin#model-binding-and-validation</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">Bind</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> obj <span class=\"token keyword\">interface</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n\tb <span class=\"token operator\">:=</span> binding<span class=\"token punctuation\">.</span><span class=\"token function\">Default</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span>Method<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">ContentType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">ShouldBindWith</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>添加表单校验</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">type</span> UserModelValidator <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tUser <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\t\tUsername <span class=\"token builtin\">string</span> <span class=\"token string\">`form:\"username\" json:\"username\" binding:\"exists,alphanum,min=4,max=255\"`</span>\n\t\tEmail    <span class=\"token builtin\">string</span> <span class=\"token string\">`form:\"email\" json:\"email\" binding:\"exists,email\"`</span>\n\t\tPassword <span class=\"token builtin\">string</span> <span class=\"token string\">`form:\"password\" json:\"password\" binding:\"exists,min=8,max=255\"`</span>\n\t\tBio      <span class=\"token builtin\">string</span> <span class=\"token string\">`form:\"bio\" json:\"bio\" binding:\"max=1024\"`</span>\n\t\tImage    <span class=\"token builtin\">string</span> <span class=\"token string\">`form:\"image\" json:\"image\" binding:\"omitempty,url\"`</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token string\">`json:\"user`</span>\n\tuserModel UserModel <span class=\"token string\">`json:\"-\"`</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>self <span class=\"token operator\">*</span>UserModelValidator<span class=\"token punctuation\">)</span> <span class=\"token function\">Bind</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n\terr <span class=\"token operator\">:=</span> common<span class=\"token punctuation\">.</span><span class=\"token function\">Bind</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> err\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>添加路由</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">UsersRegister</span><span class=\"token punctuation\">(</span>router <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>RouterGroup<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\trouter<span class=\"token punctuation\">.</span><span class=\"token function\">POST</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> UsersRegistration<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">UsersRegistration</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tuserModelValidator <span class=\"token operator\">:=</span> UserModelValidator<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> userModelValidator<span class=\"token punctuation\">.</span><span class=\"token function\">Bind</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\tc<span class=\"token punctuation\">.</span><span class=\"token function\">JSON</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>StatusUnprocessableEntity<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span>\n\t<span class=\"token punctuation\">}</span>\n\tc<span class=\"token punctuation\">.</span><span class=\"token function\">JSON</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>StatusCreated<span class=\"token punctuation\">,</span> userModelValidator<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"Golang 实战（二）","date":"December 16, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/go-example/go-example-2/","previous":{"fields":{"slug":"/go/golang-low-level-1/"},"frontmatter":{"title":"Golang 底层编程（一）"}},"next":{"fields":{"slug":"/go-example/go-example-1/"},"frontmatter":{"title":"Golang 实战（一）"}}}}}