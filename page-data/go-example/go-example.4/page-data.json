{"componentChunkName":"component---src-templates-blog-post-js","path":"/go-example/go-example.4/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"5711c876-e18b-5c29-b789-5177f50e7fb3","excerpt":"Go 实战（四）序列化生成 token","html":"<h2>Go 实战（四）</h2>\n<h4>序列化</h4>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">type</span> UserSerializer <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tc <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> UserResponse <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tUsername <span class=\"token builtin\">string</span>  <span class=\"token string\">`json:\"username\"`</span>\n\tEmail    <span class=\"token builtin\">string</span>  <span class=\"token string\">`json:\"email\"`</span>\n\tBio      <span class=\"token builtin\">string</span>  <span class=\"token string\">`json:\"bio\"`</span>\n\tImage    <span class=\"token operator\">*</span><span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"image\"`</span>\n\tToken    <span class=\"token builtin\">string</span>  <span class=\"token string\">`json:\"token\"`</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>self <span class=\"token operator\">*</span>UserSerializer<span class=\"token punctuation\">)</span> <span class=\"token function\">Response</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> UserResponse <span class=\"token punctuation\">{</span>\n\tuserModel <span class=\"token operator\">:=</span> self<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span><span class=\"token function\">MustGet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_user_model\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>UserModel<span class=\"token punctuation\">)</span>\n\tuser <span class=\"token operator\">:=</span> UserResponse<span class=\"token punctuation\">{</span>\n\t\tUsername<span class=\"token punctuation\">:</span> userModel<span class=\"token punctuation\">.</span>Username<span class=\"token punctuation\">,</span>\n\t\tEmail<span class=\"token punctuation\">:</span>    userModel<span class=\"token punctuation\">.</span>Email<span class=\"token punctuation\">,</span>\n\t\tBio<span class=\"token punctuation\">:</span>      userModel<span class=\"token punctuation\">.</span>Bio<span class=\"token punctuation\">,</span>\n\t\tImage<span class=\"token punctuation\">:</span>    userModel<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">,</span>\n\t\tToken<span class=\"token punctuation\">:</span>    common<span class=\"token punctuation\">.</span><span class=\"token function\">GenToken</span><span class=\"token punctuation\">(</span>userModel<span class=\"token punctuation\">.</span>ID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> user\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>生成 token</h4>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">const</span> PasswordSecret <span class=\"token operator\">=</span> <span class=\"token string\">\"123rweg45442tefsgg\"</span>\n<span class=\"token comment\">// 生成 token</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">GenToken</span><span class=\"token punctuation\">(</span>id <span class=\"token builtin\">uint</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n\tjwtToken <span class=\"token operator\">:=</span> jwt<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">.</span><span class=\"token function\">GetSigningMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HS256\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\tjwtToken<span class=\"token punctuation\">.</span>Claims <span class=\"token operator\">=</span> jwt<span class=\"token punctuation\">.</span>MapClaims<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span> id<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"exp\"</span><span class=\"token punctuation\">:</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>Hour <span class=\"token operator\">*</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\ttoken<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> jwtToken<span class=\"token punctuation\">.</span><span class=\"token function\">SignedString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>PasswordSecret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> token\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"Go 实战（四）","date":"December 19, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/go-example/go-example.4/","previous":{"fields":{"slug":"/go-example/go-exmaple-3/"},"frontmatter":{"title":"Go 实战（三）"}},"next":{"fields":{"slug":"/go-rpc/go-rpc-1/"},"frontmatter":{"title":"Go RPC (一)"}}}}}