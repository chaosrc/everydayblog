{"componentChunkName":"component---src-templates-blog-post-js","path":"/mysql/mysql-variables/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"b1b93d82-f45b-5026-bc17-f2ffa7c15ae5","excerpt":"MySQL 用户变量很多时候我们需要保存 SQL 语句检索的结果，比如想在后面的 SQL 语句中使用这个值，或者想保存这个值在之后显示。使用用户变量允许我们保存结果之后再使用举一个例子，下面的 SQL…","html":"<h2>MySQL 用户变量</h2>\n<p>很多时候我们需要保存 SQL 语句检索的结果，比如想在后面的 SQL 语句中使用这个值，或者想保存这个值在之后显示。使用用户变量允许我们保存结果之后再使用</p>\n<p>举一个例子，下面的 SQL 语句查找艺术家的名字并将它保存在一个用户变量中</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"> <span class=\"token keyword\">SELECT</span> <span class=\"token variable\">@artist</span>:<span class=\"token operator\">=</span>artist_name \n <span class=\"token keyword\">FROM</span> artist \n <span class=\"token keyword\">WHERE</span> artist_id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>输出</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token operator\">+</span><span class=\"token comment\">----------------------+</span>\n<span class=\"token operator\">|</span> <span class=\"token variable\">@artist</span>:<span class=\"token operator\">=</span>artist_name <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------------------+</span>\n<span class=\"token operator\">|</span> swift                <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------------------+</span></code></pre></div>\n<p>上面的语句中，使用 @ 符合来表示用户变量，使用 := 操作符来给变量赋值</p>\n<p>可以使用 SELECT 语句来打印变量的内容</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> <span class=\"token variable\">@artist</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">---------+</span>\n<span class=\"token operator\">|</span> <span class=\"token variable\">@artist</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">---------+</span>\n<span class=\"token operator\">|</span> swift   <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">---------+</span></code></pre></div>\n<p>也可以不使用 SELECT 语句直接给变量赋值，比如初始化一个变量</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SET</span> <span class=\"token variable\">@counter</span> :<span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>同时初始化多个变量</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SET</span> <span class=\"token variable\">@counter</span> :<span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">@age</span> :<span class=\"token operator\">=</span> <span class=\"token number\">18</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>变量最常用的方式是保存查询结果，然后在后面的语句中使用。比如在一个音乐数据库中查询最近播放歌曲的名字</p>\n<p>在不使用变量时，首先要查找到最近一次播放的时间，然后将这个时间做为 WHERE 子句的条件查询歌曲的名字</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> <span class=\"token function\">MAX</span><span class=\"token punctuation\">(</span>played<span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> played<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------------------+</span>\n<span class=\"token operator\">|</span> played                <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------------------+</span>\n<span class=\"token operator\">|</span> <span class=\"token number\">2018</span><span class=\"token operator\">-</span><span class=\"token number\">05</span><span class=\"token operator\">-</span><span class=\"token number\">09</span> <span class=\"token number\">15</span>:<span class=\"token number\">44</span>:<span class=\"token number\">23</span>   <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----------------------+</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> track_name \n<span class=\"token keyword\">FROM</span> track \n<span class=\"token keyword\">INNER</span> <span class=\"token keyword\">JOIN</span> played \n<span class=\"token keyword\">USING</span> <span class=\"token punctuation\">(</span>artist_id<span class=\"token punctuation\">,</span> album_id<span class=\"token punctuation\">,</span> track_id<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">WHERE</span> played <span class=\"token operator\">=</span> <span class=\"token string\">\"2018-05-09 15:44:23 \"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>下面是使用变量的语句</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> <span class=\"token variable\">@recent</span> :<span class=\"token operator\">=</span> <span class=\"token function\">MAX</span><span class=\"token punctuation\">(</span>played<span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> played<span class=\"token punctuation\">;</span>\n\nmysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> track_name \n<span class=\"token keyword\">FROM</span> track \n<span class=\"token keyword\">INNER</span> <span class=\"token keyword\">JOIN</span> played \n<span class=\"token keyword\">USING</span> <span class=\"token punctuation\">(</span>artist_id<span class=\"token punctuation\">,</span> album_id<span class=\"token punctuation\">,</span> track_id<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">WHERE</span> played <span class=\"token operator\">=</span> <span class=\"token variable\">@recent</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>使用变量的一些原则</p>\n<ul>\n<li>用户变量是对于连接唯一的，不同的链接可以有相同的名字，但是是两个变量</li>\n<li>变量名是字母数字字符串，也可以是点（.）、下划线（_）和 美元符号（$)</li>\n<li>在 MySQL 版本 5 之前变量名大小写敏感，在 5 之后的版本大小写不区分</li>\n<li>变量没有初始化时为 NULL 值</li>\n<li>当连接断开时变量被销毁</li>\n<li>尽量不要在一个查询语句中同时赋值和使用同一个变量。因为变量赋值后可能无法在同一个 SQL 语句中立即生效</li>\n</ul>","frontmatter":{"title":"MySQL 用户变量","date":"October 05, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/mysql/mysql-variables/","previous":{"fields":{"slug":"/mysql/mysql-entity-model-example/"},"frontmatter":{"title":"实体关系建模示例"}},"next":{"fields":{"slug":"/mysql/mysql-backup/"},"frontmatter":{"title":"MySQL 备份"}}}}}