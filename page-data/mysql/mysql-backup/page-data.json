{"componentChunkName":"component---src-templates-blog-post-js","path":"/mysql/mysql-backup/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"77bd554e-468e-5401-bdb4-e7d6d6ac626b","excerpt":"MySQL 备份数据库做为 SQL 语句导出通过生成一个文件，这个文件中包含重新创建这个数据库结构的所有 SQL 语句，来进行备份，如果需要也可以包含所有插入数据的 SQL 语句SQL 语句是一种很好的备份方式，SQL 语句中仅包含文本，能够进行压缩下面我们来使用 mysqldump 备份一下 tysql…","html":"<h2>MySQL 备份</h2>\n<h4>数据库做为 SQL 语句导出</h4>\n<p>通过生成一个文件，这个文件中包含重新创建这个数据库结构的所有 SQL 语句，来进行备份，如果需要也可以包含所有插入数据的 SQL 语句</p>\n<p>SQL 语句是一种很好的备份方式，SQL 语句中仅包含文本，能够进行压缩</p>\n<p>下面我们来使用 mysqldump 备份一下 tysql 这个数据库</p>\n<p>输入</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">mysqldump -uroot -p --result-file=tysql.backup.sql tysql</code></pre></div>\n<p>上面的命令创建了一个 tysql.backup.sql 文件，打开文件可以看内容下面的内容</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- MySQL dump 10.13  Distrib 8.0.17, for Linux (x86_64)</span>\n<span class=\"token comment\">--</span>\n<span class=\"token comment\">-- Host: localhost    Database: tysql</span>\n<span class=\"token comment\">-- ------------------------------------------------------</span>\n<span class=\"token comment\">-- Server version\t8.0.17</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Customers<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/*!50503 SET character_set_client = utf8mb4 */</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Customers<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">`</span>cust_id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>cust_name<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>cust_address<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>cust_city<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>cust_state<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>cust_zip<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>cust_country<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>cust_contact<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>cust_email<span class=\"token punctuation\">`</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>cust_id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COLLATE</span><span class=\"token operator\">=</span>utf8mb4_0900_ai_ci<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/*!40101 SET character_set_client = @saved_cs_client */</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">--</span>\n<span class=\"token comment\">-- Dumping data for table `Customers`</span>\n<span class=\"token comment\">--</span>\n\n<span class=\"token keyword\">LOCK</span> <span class=\"token keyword\">TABLES</span> <span class=\"token punctuation\">`</span>Customers<span class=\"token punctuation\">`</span> <span class=\"token keyword\">WRITE</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/*!40000 ALTER TABLE `Customers` DISABLE KEYS */</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>Customers<span class=\"token punctuation\">`</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'1000000001'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Village Toys'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'200 Maple Lane'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Detroit'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'MI'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'44444'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'USA'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'John Smith'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'sales@villagetoys.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1000000002'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Kids Place'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'333 South Lake Drive'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Columbus'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'OH'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'43333'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'USA'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Michelle Green'</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1000000003'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Fun4All'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'1 Sunny Place'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Muncie'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'IN'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'42222'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'USA'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Jim Jones'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'jjones@fun4all.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1000000004'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Fun4All'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'829 Riverside Drive'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Phoenix'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'AZ'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'88888'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'USA'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Denise L. Stephens'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dstephens@fun4all.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1000000005'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'The Toy Store'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'4545 53rd Street'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Chicago'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'IL'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'54545'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'USA'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Kim Howard'</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/*!40000 ALTER TABLE `Customers` ENABLE KEYS */</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">UNLOCK</span> <span class=\"token keyword\">TABLES</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>导出文件包含的内容</p>\n<ul>\n<li>DROP TABLE 如果表已经存在则先删除表，防止导入数据是出错</li>\n<li>CREATE TABLE 创建表</li>\n<li>INSERT 将所有的数据添加到表中</li>\n<li>LOCK TABLES 和 UNLOCK TABLES，确保只有当前用户在修改数据库</li>\n</ul>\n<h4>导入备份数据</h4>\n<p>通过读取导出文件中的 SQL 语句，来创建数据库结构以及插入数据</p>\n<p>创建一个新的数据库</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> tysql2<span class=\"token punctuation\">;</span></code></pre></div>\n<p>选择数据库</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">USE</span> tysql2<span class=\"token punctuation\">;</span></code></pre></div>\n<p>导入数据</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">SOURCE <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>mysql<span class=\"token operator\">/</span>tysql<span class=\"token punctuation\">.</span><span class=\"token keyword\">backup</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">sql</span></code></pre></div>","frontmatter":{"title":"MySQL 备份","date":"October 06, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/mysql/mysql-backup/","previous":{"fields":{"slug":"/mysql/mysql-variables/"},"frontmatter":{"title":"MySQL 用户变量"}},"next":{"fields":{"slug":"/go/golang-structure/"},"frontmatter":{"title":"Go 程序结构（一）"}}}}}