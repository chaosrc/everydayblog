{"componentChunkName":"component---src-templates-blog-post-js","path":"/nodejs/what-is-nodejs-ejs/","webpackCompilationHash":"eb9b7fa042d48e7c3b06","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"59cb1254-a96a-5225-b05e-fc5fbdf3fc61","excerpt":"在 Node.js 中使用模版渲染Node.js 中模版引擎有很多种，这里使用简单易学的EJS模版什么是 EJSEJS 中的 E 是 “Embedded”，即嵌入式 Javascript，是一个使用纯 Javascript 生成 HTML 的模版语言安装 EJS 模块渲染模版在 HTTP 路由中添加模版渲染EJS…","html":"<h2>在 Node.js 中使用模版渲染</h2>\n<p>Node.js 中模版引擎有很多种，这里使用简单易学的<a href=\"https://ejs.co/\">EJS</a>模版</p>\n<h4>什么是 EJS</h4>\n<p>EJS 中的 E 是 “Embedded”，即嵌入式 Javascript，是一个使用纯 Javascript 生成 HTML 的模版语言<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup></p>\n<h4>安装 EJS 模块</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> ejs</code></pre></div>\n<h4>渲染模版</h4>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 引入ejs模块</span>\n<span class=\"token keyword\">import</span> ejs<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> RenderFileCallback <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ejs\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ArticleType <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../src/model/types\"</span>\n\n<span class=\"token comment\">// 创建 article.ejs 文件，使用ejs渲染</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">renderArticel</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">:</span> ArticleType<span class=\"token punctuation\">,</span> cb<span class=\"token punctuation\">:</span> RenderFileCallback<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ejs<span class=\"token punctuation\">.</span><span class=\"token function\">renderFile</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">\"/article.ejs\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> cb<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>在 HTTP 路由中添加模版渲染</h4>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token comment\">// 引入定义好的渲染方法</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> renderArticel <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./views\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/articles/:id\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n  articels<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">:</span> Error<span class=\"token punctuation\">,</span> row<span class=\"token punctuation\">:</span> ArticleType</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 将数据渲染成HTML，并发送给用户</span>\n    <span class=\"token function\">renderArticel</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> html</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// res.send(row);</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>EJS 语法</h3>\n<p>模版标签的含义<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup></p>\n<ul>\n<li>&#x3C;% ‘脚本’ 标签，流程控制，不输出到 HTML</li>\n<li>&#x3C;%= 输出数据到模版</li>\n<li>&#x3C;%_ 删除其前面的空格符</li>\n<li>&#x3C;%- 输出非转义的数据到模板</li>\n<li>%> 一般结束标签</li>\n<li>-%> 删除紧随其后的换行符</li>\n<li>_%> 将结束标签后面的空格符删除</li>\n</ul>\n<p>比较常用的是 <code class=\"language-text\">&lt;%</code> 和 <code class=\"language-text\">&lt;=</code>，对应脚本逻辑和 HMTL 输出</p>\n<p>比如：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- 文件 article.ejs --></span>\n&lt;% if ( title ) { %>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span>Title: &lt;%= title %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span>\n&lt;% } %></code></pre></div>\n<p>if 语句在 &#x3C;% 和 %> 之间，不会输出，title 在&#x3C;%= 和 %>之间，输出为 HTML。最终渲染结果为：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span>Title: Node.js<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>完整的文章和文章列表的模版</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- 文件 article.ejs  --></span>\n&lt;% if ( title ) { %>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>标题: &lt;%= title %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n&lt;% } %> \n&lt;% if (content) { %>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>&lt;%= content %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n&lt;% } %></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">&lt;% rows.forEach((art) => { %>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span>&lt;%= art.title %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n  &lt;%= art.content.length > 100 ? art.content.slice(0, 97) + '...' : art.content\n  %>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n&lt;% }) %></code></pre></div>\n<p>访问 <a href=\"http://localhost:8800/articles\">http://localhost:8800/articles</a> 查看文章列表渲染结果\n<img src=\"https://s2.ax1x.com/2019/07/03/ZYlBiq.png\"></p>\n<p>访问 <a href=\"http://localhost:8800/articles/4\">http://localhost:8800/articles/4</a> 查看id为4的文章渲染结果\n<img src=\"https://s2.ax1x.com/2019/07/03/ZYlwon.png\"></p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p><a href=\"https://ejs.co/\">https://ejs.co/</a></p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n<li id=\"fn-2\">\n<p><a href=\"https://ejs.bootcss.com/\">https://ejs.bootcss.com/</a></p>\n<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","frontmatter":{"title":"在 Node.js 中使用模版渲染","date":"July 02, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/nodejs/what-is-nodejs-ejs/","previous":{"fields":{"slug":"/nodejs/what-is-node-js-sql/"},"frontmatter":{"title":"在 Node.js Web 程序中添加数据库"}},"next":{"fields":{"slug":"/nodejs/nodejs-web-framework/"},"frontmatter":{"title":"Node.js Web 框架比较"}}}}}