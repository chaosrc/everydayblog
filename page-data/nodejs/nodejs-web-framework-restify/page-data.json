{"componentChunkName":"component---src-templates-blog-post-js","path":"/nodejs/nodejs-web-framework-restify/","webpackCompilationHash":"244ee56c36e36966767c","result":{"data":{"site":{"siteMetadata":{"title":"温故而知新","author":"chao"}},"markdownRemark":{"id":"be916c36-3921-5e53-b76d-587be5b11375","excerpt":"Node.js Web 框架之 RestifyRestify Web 服务框架，专门针对构建语义正确的 RESTful Web 服务进行了优化，可以大规模地用于生产安装创建 Web 服务curl 访问添加路由Restify 路由类似于 Express，用 HTTP 动词和参数化的 URL…","html":"<h2>Node.js Web 框架之 Restify</h2>\n<p>Restify Web 服务框架，专门针对构建语义正确的 RESTful Web 服务进行了优化，可以大规模地用于生产<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup></p>\n<h4>安装</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> restify</code></pre></div>\n<h4>创建 Web 服务</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> restify <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"restify\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> restify<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/home\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This is home page\\n\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8804</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Restify server start at 8804\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>curl 访问</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> -is localhost:8804/home -H <span class=\"token string\">\"accept: text/plain\"</span>\nHTTP/1.1 200 OK\nServer: restify\nContent-Type: text/plain\nContent-Length: 17\nDate: Fri, 05 Jul 2019 15:36:40 GMT\nConnection: keep-alive\n\nThis is home page</code></pre></div>\n<h4>添加路由</h4>\n<p>Restify 路由类似于 Express，用 HTTP 动词和参数化的 URL 来定义路由的处理函数</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">handleResponse</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`Hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/home/:name\"</span><span class=\"token punctuation\">,</span> handleResponse<span class=\"token punctuation\">)</span>\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">head</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/home/:name\"</span><span class=\"token punctuation\">,</span> handleResponse<span class=\"token punctuation\">)</span></code></pre></div>\n<p>使用 URL 参数访问</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> localhost:8804/home/foo -X POST\n<span class=\"token string\">\"Hello foo\"</span>\n\n$ <span class=\"token function\">curl</span> -is localhost:8804/home/foo -X HEAD\nHTTP/1.1 200 OK\nServer: restify\nDate: Fri, 05 Jul 2019 16:09:16 GMT\nConnection: keep-alive</code></pre></div>\n<h4>路由版本化</h4>\n<p>大部分的 RESTful API 都趋向于版本化，Restify 中通过在 header 中添加<code class=\"language-text\">Accept-Version</code>支持 <a href=\"https://semver.org/\">semver</a> 版本规范</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">handleUserV1</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`name: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleUserV2</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`NAME: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/user/:name\"</span><span class=\"token punctuation\">,</span>\n  restify<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span><span class=\"token function\">conditionalHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> version<span class=\"token punctuation\">:</span> <span class=\"token string\">\"1.0.5\"</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">:</span> handleUserV1 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> version<span class=\"token punctuation\">:</span> <span class=\"token string\">\"2.1.0\"</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">:</span> handleUserV2 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>上面定义了两个版本的<code class=\"language-text\">handleUser</code>方法，通过Restify 的 <code class=\"language-text\">conditionalHandler</code> 插件控制版本</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> -H <span class=\"token string\">\"Accept-Version: ~1\"</span> localhost:8804/user/sandy\n<span class=\"token string\">\"name: sandy\"</span>\n\n$ <span class=\"token function\">curl</span> -H <span class=\"token string\">\"Accept-Version: ~2\"</span> localhost:8804/user/sandy\n<span class=\"token string\">\"NAME: sandy\"</span>\n\n<span class=\"token comment\"># 如果不指定版本号默认选择最高的版本号</span>\n$ <span class=\"token function\">curl</span> localhost:8804/user/sandy\n<span class=\"token string\">\"NAME: sandy\"</span></code></pre></div>\n<p>Restify 以建立正确的 RESTful Web 服务为目标，规范化 RESTful Web 服务的开发，使得开发流程变得简单，同时支持 WebSocket、错误处理、插件等功能</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p><a href=\"http://restify.com/\">http://restify.com/</a></p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","frontmatter":{"title":"Node.js Web 框架之 Restify","date":"July 05, 2019","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/nodejs/nodejs-web-framework-restify/","previous":{"fields":{"slug":"/nodejs/nodejs-web-framework/"},"frontmatter":{"title":"Node.js Web 框架比较"}},"next":{"fields":{"slug":"/nodejs/nodejs-web-framework-sails/"},"frontmatter":{"title":"Node.js Web 框架之 Sails"}}}}}